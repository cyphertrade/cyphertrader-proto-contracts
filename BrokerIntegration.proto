syntax = "proto3";
package broker_integration;
import "google/protobuf/empty.proto";

enum BrokerIntegrationErrorType{
    DifficultyNotFound = 0;
    InvalidMinEquityRatio = 1;
    DatabaseError = 2;
    EmptyBrokerId = 3;
    EmptyBrokerName = 4;
    EmptyDifficultyId = 5;
    EmptyInstrumentKey = 6;
    InvalidSwapPeriodMin = 7;
    MinEquityRatioTooHigh = 8;
    NoInstruments = 9;
    InvalidSpreadRange = 10;
}

message BrokerIntegrationErrorGrpcModel{
    BrokerIntegrationErrorType error_type = 1;
    optional string message = 2;
}

message BrokerIntegrationErrorsGrpcModel{
    repeated BrokerIntegrationErrorGrpcModel Errors = 1;
}

message BrokerIntegrationBrokerGrpcModel{
    string Id = 1;
    string Name = 2;
}

message BrokerIntegrationBrokerContestSettingsGrpcModel{
    string DifficultyId = 1;
    double MinEquityRatio = 2;
    map<string, BrokerIntegrationBrokerContestSettingsInstrumentGrpcModel> InstrumentSettings = 3;
}

message BrokerIntegrationBrokerContestSettingsInstrumentGrpcModel{
    optional int32 BidPip = 1;
    optional int32 AskPip = 2;
    optional uint32 MinSpreadPip = 3;
    optional uint32 MaxSpreadPip = 4;
    repeated BrokerIntegrationBrokerContestSettingsInstrumentSwapGrpcModel Swaps = 5;
}

message BrokerIntegrationBrokerContestSettingsInstrumentSwapGrpcModel{
    uint32 SwapPercent = 1;
    uint64 SwapPeriodMin = 2;
}

message BrokerIntegrationSetupContestGrpcRequest{
    string ContestId = 1;
    string DifficultyId = 2;
    double Leverage = 3;
    double InitialBalance = 4;
    repeated string AllowedAssets = 5;
}

message BrokerIntegrationSetupContestGrpcResponse{
    oneof setup_contest_result{
        string GroupName = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationRegisterContestAccountGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message BrokerIntegrationRegisterContestAccountGrpcResponse{
    oneof register_contest_account_result{
        string AccountId = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationProcessContestEndedGrpcRequest{
    string ContestId = 1;
}

message BrokerIntegrationProcessContestEndedGrpcResponse{
    oneof process_contest_ended_result{
        google.protobuf.Empty Success = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationBrokerSettingsGrpcModel{
    string BrokerId = 1;
    string BrokerName = 2;
    BrokerIntegrationBrokerContestSettingsGrpcModel ContestSettings = 3;
}

message BrokerIntegrationInsertOrReplaceBrokerSettingsGrpcResponse{
    oneof insert_or_replace_broker_settings_result{
        BrokerIntegrationBrokerSettingsGrpcModel Settings = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

service BrokerIntegrationGrpcService{
    rpc InsertOrUpdateBrokerSettings(BrokerIntegrationBrokerSettingsGrpcModel) returns (BrokerIntegrationInsertOrReplaceBrokerSettingsGrpcResponse);

    rpc SetupContest(BrokerIntegrationSetupContestGrpcRequest) returns (BrokerIntegrationSetupContestGrpcResponse);
    rpc RegisterContestAccount(BrokerIntegrationRegisterContestAccountGrpcRequest) returns (BrokerIntegrationRegisterContestAccountGrpcResponse);
    //Contest registration canceled

    rpc ProcessContestEnded(BrokerIntegrationProcessContestEndedGrpcRequest) returns (BrokerIntegrationProcessContestEndedGrpcResponse);
    //contest canceled

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
