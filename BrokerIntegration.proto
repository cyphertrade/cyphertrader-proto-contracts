syntax = "proto3";
package broker_integration;
import "google/protobuf/empty.proto";

enum BrokerIntegrationErrorType{
    DifficultyNotFound = 0;
    InvalidMinEquityRatio = 1;
    DatabaseError = 2;
    EmptyBrokerId = 3;
    EmptyBrokerName = 4;
    EmptyDifficultyId = 5;
    EmptyInstrumentKey = 6;
    InvalidSwapPeriodMin = 7;
    MinEquityRatioTooHigh = 8;
    NoInstruments = 9;
    InvalidSpreadRange = 10;
    InvalidInstrument = 11;
}

message BrokerIntegrationErrorGrpcModel{
    BrokerIntegrationErrorType ErrorType = 1;
    optional string Message = 2;
}

message BrokerIntegrationErrorsGrpcModel{
    repeated BrokerIntegrationErrorGrpcModel Errors = 1;
}

message BrokerIntegrationBrokerGrpcModel{
    string Id = 1;
    string Name = 2;
}

message BrokerIntegrationBrokerContestSettingsGrpcModel{
    string DifficultyId = 1;
    double MinEquityRatio = 2;
    map<string, BrokerIntegrationBrokerContestSettingsInstrumentGrpcModel> InstrumentSettings = 3;
    map<string, string> InstrumentMapping = 4;
}

message BrokerIntegrationBrokerContestSettingsInstrumentGrpcModel{
    optional int32 BidPip = 1;
    optional int32 AskPip = 2;
    optional uint32 MinSpreadPip = 3;
    optional uint32 MaxSpreadPip = 4;
    repeated BrokerIntegrationBrokerContestSettingsInstrumentSwapGrpcModel Swaps = 5;
    optional double Commission = 6;
}

message BrokerIntegrationBrokerContestSettingsInstrumentSwapGrpcModel{
    uint32 SwapPercent = 1;
    uint64 SwapPeriodMin = 2;
}

message BrokerIntegrationSetupContestGrpcRequest{
    string ContestId = 1;
    string DifficultyId = 2;
    double Leverage = 3;
    double InitialBalance = 4;
    repeated string AllowedAssets = 5;
}

message BrokerIntegrationSetupContestGrpcResponse{
    oneof SetupContestResult{
        string GroupName = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationRegisterContestAccountGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message BrokerIntegrationRegisterContestAccountGrpcResponse{
    oneof RegisterContestAccountResult{
        string AccountId = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationProcessContestEndedGrpcRequest{
    string ContestId = 1;
}

message BrokerIntegrationProcessContestEndedGrpcResponse{
    oneof ProcessContestEndedResult{
        google.protobuf.Empty Success = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationProcessContestCanceledGrpcRequest{
    string ContestId = 1;
}

message BrokerIntegrationProcessContestCanceledGrpcResponse{
    oneof ProcessContestCanceledResult{
        google.protobuf.Empty Success = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationBrokerSettingsGrpcModel{
    string BrokerId = 1;
    string BrokerName = 2;
    BrokerIntegrationBrokerContestSettingsGrpcModel ContestSettings = 3;
}

message BrokerIntegrationInsertOrReplaceBrokerSettingsGrpcResponse{
    oneof InsertOrReplaceBrokerSettingsResult{
        BrokerIntegrationBrokerSettingsGrpcModel Settings = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}

message BrokerIntegrationContestRegistrationCancelGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message BrokerIntegrationGetContestAccountAutoLoginGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message BrokerIntegrationGetContestAccountAutoLoginGrpcResponse{
    oneof RedirectLink{
        string Url = 1;
        BrokerIntegrationErrorsGrpcModel Errors = 2;
    }
}


service BrokerIntegrationGrpcService{
    rpc SetupContest(BrokerIntegrationSetupContestGrpcRequest) returns (BrokerIntegrationSetupContestGrpcResponse);

    rpc RegisterContestAccount(BrokerIntegrationRegisterContestAccountGrpcRequest) returns (BrokerIntegrationRegisterContestAccountGrpcResponse);
    rpc GetContestAccountAutoLogin(BrokerIntegrationGetContestAccountAutoLoginGrpcRequest) returns (BrokerIntegrationGetContestAccountAutoLoginGrpcResponse);
    rpc ContestRegistrationCanceled(BrokerIntegrationContestRegistrationCancelGrpcRequest) returns (BrokerIntegrationRegisterContestAccountGrpcResponse);

    rpc ProcessContestCanceled(BrokerIntegrationProcessContestCanceledGrpcRequest) returns (BrokerIntegrationProcessContestCanceledGrpcResponse);
    rpc ProcessContestEnded(BrokerIntegrationProcessContestEndedGrpcRequest) returns (BrokerIntegrationProcessContestEndedGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
