
syntax = "proto3";
package client_wallets;
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// ========== Enums ==========
enum WalletTransactionGrpcReason {
    DEPOSIT = 0;
    WITHDRAWAL = 1;
    REBAIT = 2;
    CORRECTION = 3;
}

enum WalletGrpcError{
    NegativeBalanceNotAllowed = 0;
    WalletNotFound = 1;
    WalletAlreadyExists = 2;
    DatabaseError = 3;
}

message WalletTransactionGrpcModel {
    string Id = 1;
    string WalletId = 2;
    string UserId = 3;
    int64 PointsDelta = 4;
    google.protobuf.Timestamp Date = 5;
    string ProcessId = 6;
    WalletTransactionGrpcReason Reason = 7;
    optional string Comment = 8;
}

message WalletGrpcModel {
    string Id = 1;
    string UserId = 2;
    int64 Points = 3;
    google.protobuf.Timestamp CreateDate = 4;
    google.protobuf.Timestamp UpdateData = 5;
    string CreateProcessId = 6;
    string UpdateProcessId = 7;
}

message UpdateClientWalletGrpcRequest{
    string WalletId = 1;
    uint64 Delta = 2;
    WalletTransactionGrpcReason Reason = 3;
    string Comment = 4;
    string ProcessId = 5;
}

message UpdateClientWalletSuccessResult{
    WalletGrpcModel Wallet = 1;
    WalletTransactionGrpcModel Transaction = 2;
}

message UpdateClientWalletResponse{
    oneof UpdateClientWalletResult{
        UpdateClientWalletSuccessResult SuccessResult = 1;
        WalletGrpcError Error = 2;
    }
}

message CreateWalletGrpcRequest{
    string UserId = 1;
    string ProcessId = 2;
}

message CreateWalletGrpcResponse{
    oneof UpdateClientWalletResult{
        WalletGrpcModel Wallet = 1;
        WalletGrpcError Error = 2;
    }
}

service ClientWalletsGrpcService{
    rpc CreateWallet(CreateWalletGrpcRequest) returns (CreateWalletGrpcResponse);
    rpc UpdateClientWallet(UpdateClientWalletGrpcRequest) returns (UpdateClientWalletResponse);
    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}