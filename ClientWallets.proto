
syntax = "proto3";
package client_wallets;
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// ========== Enums ==========
enum WalletTransactionGrpcReason {
    DEPOSIT = 0;
    WITHDRAWAL = 1;
    REBAIT = 2;
    CORRECTION = 3;
    CONTEST = 4;
}

enum ClientWalletsErrorType {
    NegativeBalanceNotAllowed = 0;
    WalletNotFound = 1;
    WalletAlreadyExists = 2;
    DatabaseError = 3;
    ClientMultipleWallets = 4;
}

message ClientWalletsErrorGrpcModel {
    ClientWalletsErrorType ErrorType = 1;
    optional string Message = 2;
}

message ClientWalletsErrorsGrpcModel {
    repeated ClientWalletsErrorGrpcModel Errors = 1;
}

message WalletTransactionGrpcModel {
    string Id = 1;
    string WalletId = 2;
    string UserId = 3;
    int64 PointsDelta = 4;
    google.protobuf.Timestamp Date = 5;
    string ProcessId = 6;
    WalletTransactionGrpcReason Reason = 7;
    optional string Comment = 8;
}

message WalletGrpcModel {
    string Id = 1;
    string UserId = 2;
    int64 Points = 3;
    google.protobuf.Timestamp CreateDate = 4;
    google.protobuf.Timestamp UpdateData = 5;
    string CreateProcessId = 6;
    string UpdateProcessId = 7;
}

message UpdateClientWalletGrpcRequest{
    string WalletId = 1;
    int64 Delta = 2;
    WalletTransactionGrpcReason Reason = 3;
    string Comment = 4;
    string ProcessId = 5;
    bool AllowNegativeBalance =6;
}

message UpdateClientWalletSuccessResult{
    WalletGrpcModel Wallet = 1;
    WalletTransactionGrpcModel Transaction = 2;
}

message UpdateClientWalletResponse{
    oneof UpdateClientWalletResult{
        UpdateClientWalletSuccessResult SuccessResult = 1;
        ClientWalletsErrorGrpcModel Error = 2;
    }
}

message CreateWalletGrpcRequest{
    string UserId = 1;
    string ProcessId = 2;
}

message CreateWalletGrpcResponse{
    oneof UpdateClientWalletResult{
        WalletGrpcModel Wallet = 1;
        ClientWalletsErrorGrpcModel Error = 2;
    }
}

message GetClientWalletsGrpcRequest{
    string UserId = 1;
}

message GetClientWalletsSuccessResult{
    repeated WalletGrpcModel Wallets = 1;
}

message GetClientWalletsGrpcResponse{
    oneof GetClientWalletsResult{
        GetClientWalletsSuccessResult SuccessResult = 1;
        ClientWalletsErrorGrpcModel Error = 2;
    }
}

message UpdateClientWalletBalanceGrpcRequest{
    string UserId = 1;
    int64 Delta = 2;
    WalletTransactionGrpcReason Reason = 3;
    string Comment = 4;
    string ProcessId = 5;
    bool AllowNegativeBalance =6;
}

message UpdateClientWalletBalanceGrpcResponse{
    oneof UpdateClientWalletBalance{
        UpdateClientWalletSuccessResult SuccessResult = 1;
        ClientWalletsErrorGrpcModel Error = 2;
    }
}

service ClientWalletsGrpcService{
    rpc CreateWallet(CreateWalletGrpcRequest) returns (CreateWalletGrpcResponse);
    rpc UpdateClientWallet(UpdateClientWalletGrpcRequest) returns (UpdateClientWalletResponse);
    rpc GetClientWallets(GetClientWalletsGrpcRequest) returns (GetClientWalletsGrpcResponse);
    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
