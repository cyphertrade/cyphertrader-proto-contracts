syntax = "proto3";
package contest_engine;
import "google/protobuf/empty.proto";

enum ContestEngineErrorType{
    ContestNotFound = 0;
    DatabaseError = 1;
    ValidationError = 2;
}

enum ContestEngineContestRegistrationStatus{
    Registered = 0;
    Canceled = 1;
}


message ContestEngineErrorGrpcModel{
    ContestEngineErrorType ErrorType = 1;
    optional string Message = 2;
}


enum ContestEngineContestGrpcStatus{
    Draft = 0;
    RegistrationOpen = 1;
    Active = 2;
    ContestCanceled = 3;
    Failed = 4;
}

message ContestEngineContestTeamGrpcModel{
    string Id = 1;
    string Name = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineContestRegistrationTeamMemberGrpcModel{
    string UserId = 1;
    bool IsTeamLead = 2;
    double WinPercent = 3;
}


message ContestEngineContestGrpcModel {
    string Id = 1;
    string Name = 2;
    string CreatorUserId = 3;

    double PlatformCommissionPercent = 4;
    double CreatorCommissionPercent = 5;

    uint32 MinParticipants = 6;
    uint32 MaxParticipants = 7;

    double ContestLeverage = 8;
    double ContestInitialBalance = 9;

    uint32 ContestDurationMin = 10;
    optional uint64 BuyIn = 11;

    repeated string AllowedAssets = 12;
    repeated string AllowedDifficulties = 13;

    string Broker = 14;
    optional uint64 InitialPrizePool = 15;

    uint64 ContestStartDateTimeUnixMs = 16;
    ContestEngineContestGrpcStatus Status = 17;
    
    optional uint32 MinTeamSize = 18;
    optional uint32 MaxTeamSize = 19;
    
    bool FillInstantStart = 20;
}


message ContestEngineContestRegistrationGrpcModel{
    string UserId = 1;
    optional string TeamId = 2;
    optional string IsTeamLead = 3;
    ContestEngineContestAccountGrpcModel ContestAccount = 4;
    ContestEngineContestRegistrationStatus Status = 5;
}

message ContestEngineContestAccountGrpcModel{
    string Id = 1;
    string ContestId = 2;
    string UserId = 3;
    double Balance = 4;
    double Equity = 5;
    double Margin = 6;
    double FreeMargin = 7;
}

message ContestEngineCreateContestGrpcRequest{
    string UserId = 1;
    string Name = 2;
    double CreatorCommission = 3;
    double MinParticipants = 4;
    double MaxParticipants = 5;

    optional uint32 MinTeamSize = 6;
    optional uint32 MaxTeamSize = 7;

    double ContestLeverage = 8;
    double ContestInitialBalance = 9;

    uint32 ContestDurationMinutes = 10;

    optional uint64 BuyIn = 11;
    repeated string AllowedAssets = 12;
    repeated string AllowedDifficulties = 13;
    string Broker = 14;
    optional uint64 InitialPrizePool = 15;
    bool AutoStartWhenFull = 16;
    uint64 ContestStartDateTimeUnixMs = 17;
}

message ContestEngineUpdateContestGrpcResponse{
    oneof CreateContestResult{
        ContestEngineContestGrpcModel Contest = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}


message ContestEngineContestActionGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message ContestEngineGetContestRegistrationsGrpcRequest{
    string ContestId = 1;
}

message ContestEngineRegisterToContestGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
    optional string TeamId = 3;
}

message ContestEngineInsertOrUpdateContestTeamGrpcRequest{
    string ContestId = 1;
    string TeamName = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineInsertOrUpdateContestTeamGrpcResponse{
    oneof CreateContestTeamResult{
        ContestEngineContestTeamGrpcModel Team = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineUpdateContestGrpcRequest{
    string UserId = 1;
    string Name = 2;
    double CreatorCommission = 3;
    double MinParticipants = 4;
    double MaxParticipants = 5;
    optional uint32 MinTeamSize = 6;
    optional uint32 MaxTeamSize = 7;
    double ContestLeverage = 8;
    double ContestInitialBalance = 9;
    uint32 ContestDurationMinutes = 10;
    optional uint64 BuyIn = 11;
    repeated string AllowedAssets = 12;
    repeated string AllowedDifficulties = 13;
    string Broker = 14;
    optional uint64 InitialPrizePool = 15;
    bool AutoStartWhenFull = 16;
}

message ContestEngineCreateContestGrpcResponse{
    oneof CreateContestResult{
        ContestEngineContestGrpcModel Contest = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEnginePublishContestGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message ContestEnginePublishContestGrpcResponse{
    oneof PublishContestResult{
        ContestEngineContestGrpcModel Contest = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineCancelContestGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message ContestEngineCancelContestGrpcResponse{
    oneof CancelContestResult{
        ContestEngineContestGrpcModel Contest = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineCreateContestTeamGrpcRequest{
    string ContestId = 1;
    string TeamName = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineCreateContestTeamGrpcResponse{
    oneof CreateContestTeamResult{
        ContestEngineContestTeamGrpcModel Team = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineUpdateContestTeamGrpcRequest{
    string ContestId = 1;
    string TeamName = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineUpdateContestTeamGrpcResponse{
    oneof UpdateContestTeamResult{
        ContestEngineContestTeamGrpcModel Team = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineUpdateContestRegistrationGrpcRequest{
    string ContestId = 1;
}

message ContestEngineGetLiveContestsGrpcRequest{
}

message ContestEngineGetRegisterOpenContestsGrpcRequest{
}

message ContestEngineGetClientContestsGrpcRequest{
}

message ContestEngineGetContestTeamsGrpcRequest{
    string ContestId = 1;
}

message ContestEngineCancelRegistrationGrpcRequest{
    string UserId = 1;
    string ContestId = 2;
}

message ContestEngineContestDifficultyGrpcModel{
    string Id = 1;
    string Name = 2;
}

message ContestEngineInsertOrReplaceContestDifficultyGrpcResponse{
    oneof InsertOrReplaceContestDifficultyResult{
        ContestEngineContestDifficultyGrpcModel Difficulty = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineContestInstrumentGroupGrpcModel{
    string Id = 1;
    string Name = 2;
}

message ContestEngineInsertOrReplaceContestInstrumentGroupGrpcResponse{
    oneof InsertOrReplaceContestInstrumentGroupResult{
        ContestEngineContestInstrumentGroupGrpcModel InstrumentGroup = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineContestInstrumentGrpcModel{
    string Id = 1;
    string Name = 2;
    string InstrumentGroupId = 3;
}

message ContestEngineInsertOrReplaceContestInstrumentGrpcResponse{
    oneof InsertOrReplaceContestInstrumentResult{
        ContestEngineContestInstrumentGrpcModel Instrument = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineContestSettingsGrpcModel{
    string Name = 1;
    string PlatformCommission = 2;
    string MinCreatorCommissionPercent = 3;
    string MaxCreatorCommissionPercent = 4;
    string MinContestParticipants = 5;
    string MaxContestParticipants = 6;
    string MinLeverage = 7;
    string MaxLeverage = 8;
    string MinInitialBalance = 9;
    string MaxInitialBalance = 10;
    uint32 MinContestDurationMinutes = 11;
    uint32 MaxContestDurationMinutes = 12;
    string MinContestBuyIn = 13;
    string MaxContestBuyIn = 14;
    repeated string AllowedDifficulties = 15;
    repeated string AllowedBrokers = 16;
    repeated string AllowedInstruments = 17;
    optional uint64 MaxInitialPrizePool = 18;
}

message ContestEngineInsertOrReplaceContestSettingsGrpcResponse{
    oneof InsertOrReplaceContestSettingsResult{
        ContestEngineContestSettingsGrpcModel Settings = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

service ContestEngineGrpcService{
    rpc GetLiveContests(ContestEngineGetLiveContestsGrpcRequest) returns (stream ContestEngineContestGrpcModel);
    rpc GetRegisterOpenContests(ContestEngineGetRegisterOpenContestsGrpcRequest) returns (stream ContestEngineContestGrpcModel);
    rpc GetClientContests(ContestEngineGetClientContestsGrpcRequest) returns (stream ContestEngineContestGrpcModel);

    rpc CreateContest(ContestEngineCreateContestGrpcRequest) returns (ContestEngineCreateContestGrpcResponse);
    rpc UpdateContest(ContestEngineUpdateContestGrpcRequest) returns (ContestEngineUpdateContestGrpcResponse);

    rpc PublishContest(ContestEnginePublishContestGrpcRequest) returns (ContestEnginePublishContestGrpcResponse);
    rpc CancelContest(ContestEngineCancelContestGrpcRequest) returns (ContestEngineCancelContestGrpcResponse);
    
    rpc GetContestRegistrations(ContestEngineGetContestRegistrationsGrpcRequest) returns (stream ContestEngineContestRegistrationGrpcModel);
    rpc UpdateContestRegistration(ContestEngineUpdateContestRegistrationGrpcRequest) returns (ContestEngineContestRegistrationGrpcModel);
    rpc CancelContestRegistration(ContestEngineCancelRegistrationGrpcRequest) returns (ContestEngineContestRegistrationGrpcModel);

    rpc GetContestTeams(ContestEngineGetContestTeamsGrpcRequest) returns (stream ContestEngineContestTeamGrpcModel);
    rpc CreateContestTeam(ContestEngineCreateContestTeamGrpcRequest) returns (ContestEngineCreateContestTeamGrpcResponse);
    rpc UpdateContestTeam(ContestEngineUpdateContestTeamGrpcRequest) returns (ContestEngineUpdateContestTeamGrpcResponse);

    rpc InsertOrReplaceContestDifficulty(ContestEngineContestDifficultyGrpcModel) returns (ContestEngineInsertOrReplaceContestDifficultyGrpcResponse);
    rpc InsertOrReplaceContestInstrumentGroup(ContestEngineContestInstrumentGroupGrpcModel) returns (ContestEngineInsertOrReplaceContestInstrumentGroupGrpcResponse);
    rpc InsertOrReplaceContestInstrument(ContestEngineContestInstrumentGrpcModel) returns (ContestEngineInsertOrReplaceContestInstrumentGrpcResponse);
    rpc InsertOrReplaceContestSettings(ContestEngineContestSettingsGrpcModel) returns (ContestEngineInsertOrReplaceContestSettingsGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}