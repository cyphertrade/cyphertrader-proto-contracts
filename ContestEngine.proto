syntax = "proto3";
package client_wallets;
import "google/protobuf/empty.proto";

enum ContestEngineErrorType{
    ContestNotFound = 0;
    DatabaseError = 1;
}

enum ContestEngineContestRegistrationStatus{
    Registered = 0;
    Canceled = 1;
}


message ContestEngineErrorGrpcModel{
    ContestEngineErrorType error_type = 1;
    optional string message = 2;
}


enum ContestEngineContestGrpcStatus{
    Draft = 0;
    RegistrationOpen = 1;
    Active = 2;
    ContestCanceled = 3;
    Failed = 4;
}

message ContestEngineContestTeamGrpcModel{
    string Id = 1;
    string Name = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineContestRegistrationTeamMemberGrpcModel{
    string UserId = 1;
    bool IsTeamLead = 2;
    double WinPercent = 3;
}


message ContestEngineContestGrpcModel {
    string Id = 1;
    string Name = 2;
    string CreatorUserId = 3;

    double PlatformCommissionPercent = 4;
    double CreatorCommissionPercent = 5;

    uint32 MinParticipants = 6;
    uint32 MaxParticipants = 7;

    double ContestLeverage = 8;
    double ContestInitialBalance = 9;

    uint32 ContestDurationMin = 10;
    optional uint64 BuyIn = 11;

    repeated string AllowedAssets = 12;
    repeated string AllowedDifficulties = 13;

    string Broker = 14;
    optional uint64 InitialPrizePool = 15;

    uint64 ContestStartDateTimeUnixMs = 16;
    ContestEngineContestGrpcStatus Status = 17;
    
    optional uint32 MinTeamSize = 18;
    optional uint32 MaxTeamSize = 19;
    
    bool FillInstantStart = 20;
}


message ContestEngineContestRegistrationGrpcModel{
    string UserId = 1;
    optional string TeamId = 2;
    optional string IsTeamLead = 3;
    ContestEngineContestAccountGrpcModel ContestAccount = 4;
    ContestEngineContestRegistrationStatus Status = 5;
}

message ContestEngineContestAccountGrpcModel{
    string Id = 1;
    string ContestId = 2;
    string UserId = 3;
    double Balance = 4;
    double Equity = 5;
    double Margin = 6;
    double FreeMargin = 7;
}

message ContestEngineCreateContestGrpcRequest{
    string UserId = 1;
    string Name = 2;
    double CreatorCommission = 3;
    double MinParticipants = 4;
    double MaxParticipants = 5;

    optional uint32 MinTeamSize = 6;
    optional uint32 MaxTeamSize = 7;

    double ContestLeverage = 8;
    double ContestInitialBalance = 9;

    uint32 ContestDurationMinutes = 10;

    optional uint64 BuyIn = 11;
    repeated string AllowedAssets = 12;
    repeated string AllowedDifficulties = 13;
    string Broker = 14;
    optional uint64 InitialPrizePool = 15;
    bool AutoStartWhenFull = 16;
}

message ContestEngineUpdateContestGrpcResponse{
    oneof create_contest_result{
        ContestEngineContestGrpcModel Contest = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}


message ContestEngineContestActionGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
}

message ContestEngineGetContestRegistrationsGrpcRequest{
    string ContestId = 1;
}

message ContestEngineRegisterToContestGrpcRequest{
    string ContestId = 1;
    string UserId = 2;
    optional string TeamId = 3;
}

message ContestEngineInsertOrUpdateContestTeamGrpcRequest{
    string ContestId = 1;
    string TeamName = 2;
    bool IsPublic = 3;
    repeated ContestEngineContestRegistrationTeamMemberGrpcModel Members = 4;
}

message ContestEngineInsertOrUpdateContestTeamGrpcResponse{
    oneof create_contest_team_result{
        ContestEngineContestTeamGrpcModel Team = 1;
        ContestEngineErrorGrpcModel Error = 2;
    }
}

message ContestEngineCancelRegistrationGrpcRequest{
    string UserId = 1;
    string ContestId = 2;
}


service ContestEngineGrpcService{
    rpc GetLiveContests(google.protobuf.Empty) returns (stream ContestEngineContestGrpcModel);
    rpc GetRegisterOpenContests(google.protobuf.Empty) returns (stream ContestEngineContestGrpcModel);
    rpc GetClientContests(google.protobuf.Empty) returns (stream ContestEngineContestGrpcModel);

    rpc CreateContest(ContestEngineCreateContestGrpcRequest) returns (ContestEngineUpdateContestGrpcResponse);
    rpc UpdateContest(ContestEngineCreateContestGrpcRequest) returns (ContestEngineUpdateContestGrpcResponse);

    rpc PublishContest(ContestEngineContestActionGrpcRequest) returns (ContestEngineUpdateContestGrpcResponse);
    rpc CancelContest(ContestEngineContestActionGrpcRequest) returns (ContestEngineUpdateContestGrpcResponse);
    
    rpc GetContestRegistrations(ContestEngineGetContestRegistrationsGrpcRequest) returns (stream ContestEngineContestRegistrationGrpcModel);
    rpc UpdateContestRegistration(ContestEngineGetContestRegistrationsGrpcRequest) returns (ContestEngineContestRegistrationGrpcModel);
    rpc CancelContestRegistration(ContestEngineCancelRegistrationGrpcRequest) returns (ContestEngineContestRegistrationGrpcModel);

    rpc GetContestTeams(ContestEngineGetContestRegistrationsGrpcRequest) returns (stream ContestEngineContestTeamGrpcModel);
    rpc CreateContestTeam(ContestEngineInsertOrUpdateContestTeamGrpcRequest) returns (ContestEngineInsertOrUpdateContestTeamGrpcResponse);
    rpc UpdateContestTeam(ContestEngineInsertOrUpdateContestTeamGrpcRequest) returns (ContestEngineInsertOrUpdateContestTeamGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}