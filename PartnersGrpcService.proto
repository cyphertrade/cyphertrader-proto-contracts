syntax = "proto3";
package partners_grpc;
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

// ========== Errors and Enums ==========
enum PartnerErrorType{
    UNSPECIFIED = 0;
    DATABASE_ERROR = 1;
    USER_NOT_FOUND = 2;
    USER_GROUP_NOT_FOUND = 3;
    PARTNER_PROFILE_NOT_FOUND = 4;
    GRPC_ERROR = 5;
    CAMPAIGN_NOT_FOUND = 6;
    VALIDATION_ERRORS = 7;
    EVAL_EXP_ERRORS = 8;
    CAMPAIGN_INVALID_COMMISSION_SETTINGS = 9;
    REACHED_MAX_AMOUNT_OF_ACTIVE_CAMPAIGNS = 10;
    REACHED_MAX_AMOUNT_CAMPAIGN_PARAMS = 11;
}

message PartnerError{
    PartnerErrorType ErrorType = 1;
    optional string Message = 2;
}

// ========== Campaign Models ==========
message CampaignGrpcModel {
    string Id = 1;
    string PartnerId = 2;
    string Name = 3;
    map<string, string> DefaultUtms = 4;
}

// ========== Get Campaign ==========
message GetPartnerCampaignGrpcRequest {
    optional string CampaignId = 1;
    string PartnerId = 2;
    optional string Name = 3;
    map<string, string> UtmFilters = 4; // Filter by each UTM key-value pair
}

message GetPartnerCampaignsList {
    repeated CampaignGrpcModel Campaigns = 1;
}

message GetPartnerCampaignGrpcResponse {
    oneof GetPartnerCampaignResult {
        GetPartnerCampaignsList Campaigns = 1;
        PartnerError Error = 2;
    }
}

// ========== Create Campaign ==========
message CreatePartnerCampaignGrpcRequest {
    string PartnerId = 1;
    string Name = 2;
    map<string, string> DefaultUtms = 3;
}

message CreatePartnerCampaignGrpcResponse {
    oneof CreatePartnerCampaignResult {
        CampaignGrpcModel Campaign = 1;
        PartnerError Error = 2;
    }
}

// ========== Update Campaign ==========
message UpdatePartnerCampaignGrpcRequest {
    string CampaignId = 1;
    string PartnerId = 2;
    optional string Name = 3;
    map<string, string> DefaultUtms = 4;
}

message UpdatePartnerCampaignGrpcResponse {
    oneof UpdatePartnerCampaignResult {
        CampaignGrpcModel Campaign = 1;
        PartnerError Error = 2;
    }
}

// ========== Delete Campaign ==========
message DeletePartnerCampaignGrpcRequest {
    string CampaignId = 1;
    string PartnerId = 2;
}

message DeletePartnerCampaignGrpcResponse {
    oneof DeletePartnerCampaignResult {
        google.protobuf.Empty Success = 1;
        PartnerError Error = 2;
    }
}

// ========== Partner Profile Models ==========
message PartnerProfileGrpcModel {
    string Name = 1;
    string BaseRegisterLink = 2;
    optional PartnerProfileCommissionsGrpcModel Commissions = 3;
}

message PartnerProfileCommissionsGrpcModel {
    int64 LadderResetInHours = 1;
    map<int64, CommissionLadderStepGrpcModel> LadderSettings = 2;
}

message CommissionLadderStepGrpcModel {
    optional double BrokerCpaPercent = 1;
    optional double BrokerRevSharePercent = 2;
    optional double BattlesRevshare = 3;
    optional double ContestsRevshare = 4;
}

// ========== Get Partner Profile ==========
message GetPartnerProfileGrpcRequest {
    optional string Name = 1;
}

message GetPartnerProfilesList {
    repeated PartnerProfileGrpcModel Profiles = 1;
}

message GetPartnerProfileGrpcResponse {
    oneof GetPartnerProfileResult {
        GetPartnerProfilesList Profiles = 1;
        PartnerError Error = 2;
    }
}

// ========== Insert Or Update Partner Profile ==========
message InsertOrUpdatePartnerProfileGrpcRequest {
    string Name = 1;
    optional string BaseRegisterLink = 2;
    optional PartnerProfileCommissionsGrpcModel Commissions = 3;
}

message InsertOrUpdatePartnerProfileGrpcResponse {
    oneof InsertOrUpdatePartnerProfileResult {
        PartnerProfileGrpcModel Profile = 1;
        PartnerError Error = 2;
    }
}

// ========== Delete Partner Profile ==========
message DeletePartnerProfileGrpcRequest {
    string Name = 1;
}

message DeletePartnerProfileGrpcResponse {
    oneof DeletePartnerProfileResult {
        google.protobuf.Empty Success = 1;
        PartnerError Error = 2;
    }
}

// ========== Refferals ==========
message RefferalGrpcModel {
    string Id = 1;
    string UserId = 2;
    string PartnerId = 3;
    string Status = 4;
    string CampaignId = 5;
    map<string, string> UtmSources = 6;
    google.protobuf.Timestamp CreateDate = 7;
    google.protobuf.Timestamp LastUpdateDate = 8;
    string CreateProcessId = 9;
    string UpdateProcessId = 10;
}

message GetRefferalsGrpcRequest {
    optional string Id = 1;
    optional string UserId = 2;
    string PartnerId = 3;
    optional string Status = 4;
    optional string CampaignId = 5;
    map<string, string> UtmSources = 6;
    optional google.protobuf.Timestamp FromDate = 7;
    optional google.protobuf.Timestamp ToDate = 8;
}

message GetRefferalsList {
    repeated RefferalGrpcModel Refferals = 1;
}

message GetRefferalsGrpcResponse {
    oneof GetRefferalsResult {
        GetRefferalsList Refferals = 1;
        PartnerError Error = 2;
    }
}

// ========== Partner Transactions ==========
message PartnerTransactionGrpcModel {
    string Id = 1;
    string PartnerId = 2;
    string RefferalId = 3;
    string TransactionType = 4;
    int64 Delta = 5;
    google.protobuf.Timestamp CreateDate = 6;
    string CreateProcessId = 7;
}

message GetPartnerTransactionsGrpcRequest {
    optional string Id = 1;
    optional string RefferalId = 2;
    string PartnerId = 3;
    optional string TransactionType = 4;
    optional google.protobuf.Timestamp FromDate = 5;
    optional google.protobuf.Timestamp ToDate = 6;
}

message GetPartnerTransactionsList {
    repeated PartnerTransactionGrpcModel Transactions = 1;
}

message GetPartnerTransactionsGrpcResponse {
    oneof GetPartnerTransactionsResult {
        GetPartnerTransactionsList Transactions = 1;
        PartnerError Error = 2;
    }
}

// ========== Service ==========
service PartnersGrpcService {
    rpc GetPartnerCampaign(GetPartnerCampaignGrpcRequest) returns (GetPartnerCampaignGrpcResponse);
    rpc CreatePartnerCampaign(CreatePartnerCampaignGrpcRequest) returns (CreatePartnerCampaignGrpcResponse);
    rpc UpdatePartnerCampaign(UpdatePartnerCampaignGrpcRequest) returns (UpdatePartnerCampaignGrpcResponse);
    rpc DeletePartnerCampaign(DeletePartnerCampaignGrpcRequest) returns (DeletePartnerCampaignGrpcResponse);
    rpc GetPartnerProfile(GetPartnerProfileGrpcRequest) returns (GetPartnerProfileGrpcResponse);
    rpc InsertOrUpdatePartnerProfile(InsertOrUpdatePartnerProfileGrpcRequest) returns (InsertOrUpdatePartnerProfileGrpcResponse);
    rpc DeletePartnerProfile(DeletePartnerProfileGrpcRequest) returns (DeletePartnerProfileGrpcResponse);
    rpc GetRefferals(GetRefferalsGrpcRequest) returns (GetRefferalsGrpcResponse);
    rpc GetPartnerTransactions(GetPartnerTransactionsGrpcRequest) returns (GetPartnerTransactionsGrpcResponse);
    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
