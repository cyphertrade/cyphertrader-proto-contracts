syntax = "proto3";
package static_files;
import "google/protobuf/empty.proto";

message UploadFileChunk {
    oneof UploadChunk {
        UploadFileMetadata Metadata = 1;
        bytes Data = 2;
    }
}

message UploadFileMetadata {
    string FileName = 1;
    string ContentType = 2;
    optional int64 FileSize = 3;
    repeated string Tags = 4;
    map<string, string> CustomMetadata = 5;
}

message UploadFileResponse {
    oneof UploadResult {
        UploadFileSuccess Success = 1;
        StaticFilesError Error = 2;
    }
}

message UploadFileSuccess {
    string FileId = 1;
    int64 FileSize = 2;
    string ContentType = 3;
    string FileName = 4;
    int64 UploadedAt = 5;
}

message DownloadFileRequest {
    string FileId = 1;
    optional int64 RangeStart = 2;
    optional int64 RangeEnd = 3;
}

message DownloadFileChunk {
    oneof DownloadChunk {
        FileMetadata Metadata = 1;
        bytes Data = 2;
    }
}

message FileMetadata {
    string FileId = 1;
    string FileName = 2;
    string ContentType = 3;
    int64 FileSize = 4;
    int64 UploadedAt = 5;
    repeated string Tags = 6;
    map<string, string> CustomMetadata = 7;
}

message GetFileMetadataRequest {
    string FileId = 1;
}

message GetFileMetadataResponse {
    oneof MetadataResult {
        FileMetadata Metadata = 1;
        StaticFilesError Error = 2;
    }
}

message DeleteFileRequest {
    string FileId = 1;
}

message DeleteFileResponse {
    oneof DeleteResult {
        DeleteFileSuccess Success = 1;
        StaticFilesError Error = 2;
    }
}

message DeleteFileSuccess {
    string FileId = 1;
}

message ListFilesRequest {
    optional string ContentType = 1;
    repeated string Tags = 2;
    optional string FileNamePattern = 3;
    optional int32 Limit = 4;
    optional int32 Offset = 5;
}

message ListFilesResponse {
    oneof ListResult {
        FileMetadata File = 1;
        StaticFilesError Error = 2;
    }
}

message StaticFilesError {
    StaticFilesErrorCode Code = 1;
    string Message = 2;
}

enum StaticFilesErrorCode {
    UNKNOWN = 0;
    FILE_NOT_FOUND = 1;
    FILE_ALREADY_EXISTS = 2;
    INVALID_FILE_ID = 3;
    FILE_TOO_LARGE = 4;
    INVALID_CONTENT_TYPE = 5;
    STORAGE_ERROR = 6;
    INVALID_REQUEST = 7;
    UPLOAD_CANCELLED = 8;
    INVALID_RANGE = 9;
}

service StaticFilesService {
    rpc UploadFile(stream UploadFileChunk) returns (UploadFileResponse);

    rpc DownloadFile(DownloadFileRequest) returns (stream DownloadFileChunk);

    rpc GetFileMetadata(GetFileMetadataRequest) returns (GetFileMetadataResponse);

    rpc DeleteFile(DeleteFileRequest) returns (DeleteFileResponse);

    rpc ListFiles(ListFilesRequest) returns (stream ListFilesResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);

}