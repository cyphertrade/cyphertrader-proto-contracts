syntax = "proto3";
package users_grpc;
import "google/protobuf/empty.proto";

// Error types enumeration
enum UsersGrpcErrorType {
    UNSPECIFIED = 0;
    HASH_ERROR = 1;
    BASE64_ERROR = 2;
    INVALID_AUTH_CREDENTIALS = 3;
    USER_NOT_FOUND = 4;
    DB_ERROR = 5;
    INVALID_SETTINGS = 6;
    VALIDATION_ERROR = 7;
    USER_GROUP_NOT_FOUND = 8;
    TRADER_PROFILE_NOT_FOUND = 9;
    PARTNER_PROFILE_NOT_FOUND = 10;
    XP_PROGRESSION_NOT_FOUND = 11;
    // Email validation errors
    EMAIL_MISSING_AT = 12;
    EMAIL_LOCAL_TOO_LONG = 13;
    EMAIL_DOMAIN_TOO_LONG = 14;
    EMAIL_LOCAL_DOT_RULES = 15;
    EMAIL_LOCAL_INVALID_CHARS = 16;
    EMAIL_DOMAIN_NO_DOT = 17;
    EMAIL_LABEL_EMPTY = 18;
    EMAIL_LABEL_TOO_LONG = 19;
    EMAIL_LABEL_EDGE_HYPHEN = 20;
    EMAIL_LABEL_INVALID_CHARS = 21;
    EMAIL_TLD_INVALID = 22;
}

// Error response model
message UsersGrpcError {
    UsersGrpcErrorType ErrorType = 1;
    optional string Message = 2;
}

message UserGrpcModel{
    string Id = 1;
    string UserGroup = 2;
}

message UserGroupGrpcModel{
    string Name = 1;
    string XpProgression = 2;
    string PartnerProfile = 3;
    string TraderProfile = 4;
}

message UserDataGrpcModel{
    UserGrpcModel User = 1;
    map<string, string> Sources = 2;
}

message RegisterUserGrpcRequest {
    string Email = 1;
    string Password = 2;
}

message RegisterUserGrpcResponse{
    oneof RegisterUserResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message UpdateUserGrpcRequest{
    string Id = 1;
    string UserGroup = 2;
}

message UpdateUserGrpcResponse{
    oneof UpdateUserResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message InsertOrUpdateUserGroupGrpcResponse{
    oneof UpdateGroupResult{
        UserGroupGrpcModel Group = 1;
        UsersGrpcError Error = 2;
    }
}

message UpdateUserSourcesGrpcRequest{
    string UserId = 1;
    map<string, string> Sources = 2;
}

message UpdateUserSourcesGrpcResponse{
    oneof UpdateUserSourcesResult{
        UserDataGrpcModel UserData = 1;
        UsersGrpcError Error = 2;
    }
}

message VerifyUserCredentialsGrpcRequest{
    string Email = 1;
    string Password = 2;
}

message VerifyUserCredentialsGrpcResponse{
    oneof VerifyUserCredentialsResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message GetUserGrpcRequest{
    string UserId = 1;
}

message GetUserGrpcResponse{
    optional UserDataGrpcModel UserData = 1;
}

service UsersGrpcService {
    rpc RegisterUser (RegisterUserGrpcRequest) returns (RegisterUserGrpcResponse);
    rpc UpdateUser (UpdateUserGrpcRequest) returns (UpdateUserGrpcResponse);
    rpc UpdateUserSources (UpdateUserSourcesGrpcRequest) returns (UpdateUserSourcesGrpcResponse);
    rpc VerifyUserCredentials (VerifyUserCredentialsGrpcRequest) returns (VerifyUserCredentialsGrpcResponse);
    rpc GetUser (GetUserGrpcRequest) returns (GetUserGrpcResponse);
    rpc InsertOrUpdateUserGroup (UserGroupGrpcModel) returns (InsertOrUpdateUserGroupGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
