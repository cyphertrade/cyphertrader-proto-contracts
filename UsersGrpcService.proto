syntax = "proto3";
package users_grpc;
import "google/protobuf/empty.proto";

// Error types enumeration
enum UsersGrpcErrorType {
    UNSPECIFIED = 0;
    HASH_ERROR = 1;
    BASE64_ERROR = 2;
    INVALID_AUTH_CREDENTIALS = 3;
    USER_NOT_FOUND = 4;
    DB_ERROR = 5;
    INVALID_SETTINGS = 6;
    VALIDATION_ERROR = 7;
    USER_GROUP_NOT_FOUND = 8;
    TRADER_PROFILE_NOT_FOUND = 9;
    PARTNER_PROFILE_NOT_FOUND = 10;
    XP_PROGRESSION_NOT_FOUND = 11;
    // Email validation errors
    EMAIL_MISSING_AT = 12;
    EMAIL_LOCAL_TOO_LONG = 13;
    EMAIL_DOMAIN_TOO_LONG = 14;
    EMAIL_LOCAL_DOT_RULES = 15;
    EMAIL_LOCAL_INVALID_CHARS = 16;
    EMAIL_DOMAIN_NO_DOT = 17;
    EMAIL_LABEL_EMPTY = 18;
    EMAIL_LABEL_TOO_LONG = 19;
    EMAIL_LABEL_EDGE_HYPHEN = 20;
    EMAIL_LABEL_INVALID_CHARS = 21;
    EMAIL_TLD_INVALID = 22;
    // Public profile validation errors
    INVALID_INSTAGRAM_URL = 23;
    INVALID_DISCORD_URL = 24;
    PROFILE_DESCRIPTION_TOO_LONG = 25;
    IMAGE_NOT_FOUND = 26;
    // Personal data validation errors
    FIRST_NAME_REQUIRED = 27;
    LAST_NAME_REQUIRED = 28;
    FIRST_NAME_TOO_LONG = 29;
    LAST_NAME_TOO_LONG = 30;
    INVALID_COUNTRY_CODE = 31;
    INVALID_NATIONALITY_CODE = 32;
    INVALID_PHONE_NUMBER = 33;
    INVALID_DATE_OF_BIRTH = 34;
    INVALID_POSTAL_CODE = 35;
    FIRST_NAME_TOO_SHORT = 36;
    LAST_NAME_TOO_SHORT = 37;
}

enum GenderGrpcType {
    None = 0;
    Male = 1;
    Female = 2;
}

// Error response model
message UsersGrpcError {
    UsersGrpcErrorType ErrorType = 1;
    optional string Message = 2;
}

message UserGrpcModel{
    string Id = 1;
    string UserGroup = 2;
    optional string UserName = 3;
}

message UserGroupGrpcModel{
    string Name = 1;
    string TraderXpProgression = 2;
    string PartnerXpProgression = 3;
    string InfluencerXpProgression = 4;
    string PartnerProfile = 5;
    string TraderProfile = 6;
}

message UserDataGrpcModel{
    UserGrpcModel User = 1;
    map<string, string> Sources = 2;
}

message PublicProfileSettingsGrpcModel{
    string UserId = 1;
    optional string InstagramLink = 2;
    optional string DiscordLink = 3;
    optional string ProfileDescription = 4;
    optional string ImageIdFromCdn = 5;
    bool ShowRealName = 6;
    bool ShowTradingActivity = 7;
}

message PersonalDataGrpcModel{
    string UserId = 1;
    string FirstName = 2;
    string LastName = 3;
    optional string CountryCode = 4;
    optional string NationalityCode = 5;
    optional GenderGrpcType Gender = 6;
    optional string PhoneCode = 7;
    optional string AddressLine1 = 8;
    optional string AddressLine2 = 9;
    optional uint64 DateOfBirth = 10;
    optional string PostalCode = 11;
    optional string PhoneNumber = 12;
}

message RegisterUserGrpcRequest {
    string Email = 1;
    string Password = 2;
}

message RegisterUserGrpcResponse{
    oneof RegisterUserResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message UpdateUserGrpcRequest{
    string Id = 1;
    string UserName = 2;
    string UserGroup = 3;
}

message UpdateUserGrpcResponse{
    oneof UpdateUserResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message InsertOrUpdateUserGroupGrpcResponse{
    oneof UpdateGroupResult{
        UserGroupGrpcModel Group = 1;
        UsersGrpcError Error = 2;
    }
}

message UpdateUserSourcesGrpcRequest{
    string UserId = 1;
    map<string, string> Sources = 2;
}

message UpdateUserSourcesGrpcResponse{
    oneof UpdateUserSourcesResult{
        UserDataGrpcModel UserData = 1;
        UsersGrpcError Error = 2;
    }
}

message VerifyUserCredentialsGrpcRequest{
    string Email = 1;
    string Password = 2;
}

message VerifyUserCredentialsGrpcResponse{
    oneof VerifyUserCredentialsResult{
        UserGrpcModel User = 1;
        UsersGrpcError Error = 2;
    }
}

message GetUserGrpcRequest{
    string UserId = 1;
}

message GetUserGrpcResponse{
    oneof GetUserResult{
        UserDataGrpcModel UserData = 1;
        UsersGrpcError Error = 2;
    }
}

message PublicProfileSettingsGrpcRequest {
    PublicProfileSettingsGrpcModel ProfileSettings = 1;
}

message PublicProfileSettingsGrpcResponse{
    oneof PublicProfileSettingsResult{
        PublicProfileSettingsGrpcModel ProfileSettings = 1;
        UsersGrpcError Error = 2;
    }
}

message PersonalDataGrpcRequest {
    PersonalDataGrpcModel PersonalData = 1;
}

message PersonalDataGrpcResponse{
    oneof PersonalDataResult{
        PersonalDataGrpcModel PersonalData = 1;
        UsersGrpcError Error = 2;
    }
}

service UsersGrpcService {
    rpc RegisterUser (RegisterUserGrpcRequest) returns (RegisterUserGrpcResponse);
    rpc UpdateUser (UpdateUserGrpcRequest) returns (UpdateUserGrpcResponse);
    rpc UpdateUserSources (UpdateUserSourcesGrpcRequest) returns (UpdateUserSourcesGrpcResponse);
    rpc VerifyUserCredentials (VerifyUserCredentialsGrpcRequest) returns (VerifyUserCredentialsGrpcResponse);
    rpc GetUser (GetUserGrpcRequest) returns (GetUserGrpcResponse);
    rpc InsertOrUpdateUserGroup (UserGroupGrpcModel) returns (InsertOrUpdateUserGroupGrpcResponse);
    rpc InsertOrReplacePublicProfileData (PublicProfileSettingsGrpcRequest) returns (PublicProfileSettingsGrpcResponse);
    rpc InsertOrReplacePersonalData (PersonalDataGrpcRequest) returns (PersonalDataGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
